{% extends "base.html" %}

{% block title %}Create Plan - Fitness Club{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header Section -->
    <div class="mb-8">
        <div class="flex items-center mb-4">
            <a href="{{ url_for('plans_list') }}" class="text-blue-600 hover:text-blue-800 mr-4">
                <i class="fas fa-arrow-left text-lg"></i>
            </a>
            <h1 class="text-3xl font-bold text-gray-900">Create Membership Plan</h1>
        </div>
        <p class="text-gray-600">Design a new membership plan for your fitness club</p>
    </div>

    <!-- Form Section -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8">
        <form method="POST" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Plan Name -->
                <div class="md:col-span-2">
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
                        Plan Name <span class="text-red-500">*</span>
                    </label>
                    <input type="text" name="name" id="name" required placeholder="e.g., Premium Membership, Basic Plan"
                        class="w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>

                <!-- Price -->
                <div>
                    <label for="price" class="block text-sm font-medium text-gray-700 mb-2">
                        Price <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">$</span>
                        </div>
                        <input type="number" name="price" id="price" step="0.01" min="0" required placeholder="0.00"
                            class="w-full pl-7 rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                </div>

                <!-- Duration -->
                <div>
                    <label for="duration_months" class="block text-sm font-medium text-gray-700 mb-2">
                        Duration (Months) <span class="text-red-500">*</span>
                    </label>
                    <select name="duration_months" id="duration_months" required
                        class="w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <option value="">Select duration</option>
                        <option value="1">1 Month</option>
                        <option value="3">3 Months</option>
                        <option value="6">6 Months</option>
                        <option value="12">12 Months</option>
                        <option value="24">24 Months</option>
                    </select>
                </div>

                <!-- Description -->
                <div class="md:col-span-2">
                    <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
                        Description
                    </label>
                    <textarea name="description" id="description" rows="3"
                        placeholder="Describe what this plan includes..."
                        class="w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></textarea>
                </div>

                <!-- Features -->
                <div class="md:col-span-2">
                    <label for="features" class="block text-sm font-medium text-gray-700 mb-2">
                        Features
                    </label>
                    <textarea name="features" id="features" rows="3"
                        placeholder="e.g., Access to gym, Personal trainer, Group classes (comma-separated)"
                        class="w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></textarea>
                    <p class="mt-1 text-sm text-gray-500">Enter features separated by commas</p>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
                <a href="{{ url_for('plans_list') }}"
                    class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                    Cancel
                </a>
                <button type="submit"
                    class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-save mr-2"></i>
                    Create Plan
                </button>
            </div>
        </form>
    </div>

    <!-- Plan Preview -->
    <div id="planPreview" class="mt-8 bg-blue-50 rounded-lg p-6 hidden">
        <h3 class="text-lg font-semibold text-blue-900 mb-4">Plan Preview</h3>
        <div class="bg-white rounded-lg p-6 shadow-sm border border-blue-200">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h4 id="previewName" class="text-xl font-bold text-gray-900">Plan Name</h4>
                    <p id="previewDescription" class="text-gray-600">Plan description</p>
                </div>
                <div class="text-right">
                    <p id="previewPrice" class="text-2xl font-bold text-blue-600">$0</p>
                    <p id="previewDuration" class="text-sm text-gray-500">0 months</p>
                </div>
            </div>
            <div id="previewFeatures" class="hidden">
                <h5 class="font-medium text-gray-900 mb-2">Features:</h5>
                <div id="featuresContainer" class="flex flex-wrap gap-2">
                    <!-- Features will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Pricing Guidelines -->
    <div class="mt-8 bg-yellow-50 border border-yellow-200 rounded-lg p-6">
        <h3 class="text-lg font-semibold text-yellow-900 mb-4">
            <i class="fas fa-lightbulb mr-2"></i>
            Pricing Guidelines
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-yellow-800">
            <div>
                <h4 class="font-medium mb-2">Competitive Pricing:</h4>
                <ul class="text-sm space-y-1">
                    <li>• Basic: $29-49/month</li>
                    <li>• Premium: $59-79/month</li>
                    <li>• VIP: $89-149/month</li>
                </ul>
            </div>
            <div>
                <h4 class="font-medium mb-2">Common Features:</h4>
                <ul class="text-sm space-y-1">
                    <li>• Gym access, Locker room</li>
                    <li>• Group classes, Personal training</li>
                    <li>• Nutrition consultation, Massage</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for Plan Preview -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const nameInput = document.getElementById('name');
        const priceInput = document.getElementById('price');
        const durationSelect = document.getElementById('duration_months');
        const descriptionInput = document.getElementById('description');
        const featuresInput = document.getElementById('features');

        const planPreview = document.getElementById('planPreview');
        const previewName = document.getElementById('previewName');
        const previewPrice = document.getElementById('previewPrice');
        const previewDuration = document.getElementById('previewDuration');
        const previewDescription = document.getElementById('previewDescription');
        const previewFeatures = document.getElementById('previewFeatures');
        const featuresContainer = document.getElementById('featuresContainer');

        function updatePreview() {
            const name = nameInput.value.trim();
            const price = priceInput.value;
            const duration = durationSelect.value;
            const description = descriptionInput.value.trim();
            const features = featuresInput.value.trim();

            if (name || price || duration) {
                previewName.textContent = name || 'Plan Name';
                previewPrice.textContent = price ? `$${price}` : '$0';
                previewDuration.textContent = duration ? `${duration} months` : '0 months';
                previewDescription.textContent = description || 'Plan description';

                // Update features
                if (features) {
                    const featuresList = features.split(',').map(f => f.trim()).filter(f => f);
                    featuresContainer.innerHTML = featuresList.map(feature =>
                        `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">${feature}</span>`
                    ).join('');
                    previewFeatures.classList.remove('hidden');
                } else {
                    previewFeatures.classList.add('hidden');
                }

                planPreview.classList.remove('hidden');
            } else {
                planPreview.classList.add('hidden');
            }
        }

        // Add event listeners
        [nameInput, priceInput, durationSelect, descriptionInput, featuresInput].forEach(input => {
            input.addEventListener('input', updatePreview);
            input.addEventListener('change', updatePreview);
        });

        // Form validation
        const form = document.querySelector('form');
        form.addEventListener('submit', function (e) {
            const name = nameInput.value.trim();
            const price = priceInput.value.trim();
            const duration = durationSelect.value;

            if (!name || !price || !duration) {
                e.preventDefault();
                alert('Please fill in all required fields (Name, Price, and Duration).');
                return;
            }

            if (parseFloat(price) < 0) {
                e.preventDefault();
                alert('Price must be a positive number.');
                return;
            }
        });

        // Auto-format price input
        priceInput.addEventListener('blur', function () {
            if (this.value && !isNaN(this.value)) {
                this.value = parseFloat(this.value).toFixed(2);
                updatePreview();
            }
        });
    });
</script>
{% endblock %}